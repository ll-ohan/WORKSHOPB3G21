<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BatMap</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
<header class="topbar">
  <div class="brand">ü¶á BatMap</div>
  <nav class="tabs" id="mainTabs">
    <button class="tab-btn" data-tab="use" type="button">Utiliser une carte</button>
    <button class="tab-btn" data-tab="new" type="button">Nouvelle carte</button>
  </nav>
</header>

<main id="app">

  <!-- Vue : Utiliser une carte -->
  <section id="view-use" class="view">
    <div class="toolbar">
      <label for="citySelect">Ville</label>
      <select id="citySelect" aria-label="S√©lection de la ville"></select>
      <button id="refreshCity" class="ghost" type="button">‚Üª</button>
    </div>

    <div id="emptyStateUse" class="empty hidden">
      <p>Pas encore de cartes. Ajoute-en une dans l‚Äôonglet <strong>Nouvelle carte</strong> ‚ú®</p>
    </div>

    <div id="mapsGrid" class="grid"></div>
  </section>

  <!-- Vue : Nouvelle carte (2 formulaires) -->
  <section id="view-new" class="view hidden">

    <!-- Formulaire 1 : Upload + param√®tres -->
    <form id="formUpload" class="panel" novalidate>
      <h2>Ajouter une nouvelle carte</h2>
      <div class="field">
        <label for="cityInput">Ville</label>
        <input id="cityInput" name="city" type="text" placeholder="Ex. Toulouse" required />
      </div>
      <div class="field">
        <label for="scaleInput">√âchelle (m√®tre par cm sur plan)</label>
        <input id="scaleInput" name="scale" type="number" step="0.0001" min="0" placeholder="Ex. 12.5" required />
        <small class="hint">Utilis√©e avec le DPI pour convertir les pixels en m√®tres.</small>
      </div>
      <div class="field">
        <label for="fileInput">Image de la carte (PNG/JPG)</label>
        <input id="fileInput" name="file" type="file" accept="image/*" required />
      </div>

      <div class="actions">
        <button type="submit" id="btnUpload" class="primary">Lancer l‚Äôextraction des routes</button>
      </div>
    </form>

    <!-- Formulaire 2 : Validation du binaire -->
    <form id="formConfirm" class="panel hidden" novalidate>
      <h2>Choisir la version binaire</h2>
      <p class="hint">S√©lectionne une des images extraites ci-dessous, puis valide.</p>
      <div id="binaryChoices" class="grid bin-grid" aria-live="polite"></div>

      <div class="actions">
        <button type="submit" id="btnConfirm" class="primary" disabled>Valider et enregistrer</button>
        <button type="button" id="btnBack" class="ghost">‚üµ Retour</button>
      </div>
    </form>

    <div class="small-note">
      <p><strong>Astuce :</strong> apr√®s validation, on te redirige automatiquement vers ‚ÄúUtiliser une carte‚Äù.</p>
    </div>
  </section>

  <!-- Vue : D√©tail carte -->
  <section id="view-detail" class="view hidden">
    <div class="detail-header">
      <button id="backToList" class="ghost" type="button">‚Üê Retour</button>
      <h2 id="detailTitle">Carte</h2>
    </div>

    <div class="detail-body">
      <div class="canvas-wrap">
        <img id="mapImage" alt="Carte" />
        <canvas id="clickLayer" aria-label="S√©lection de points"></canvas>
      </div>

      <div class="panel">
        <h3>Points & actions</h3>

        <div class="mode-switch">
          <label><input type="radio" name="pickMode" value="route" checked /> S√©lection pour Trajet</label>
          <label><input type="radio" name="pickMode" value="block" /> S√©lection pour Barrer une route</label>
        </div>

        <div class="coords">
          <div>
            <strong>Trajet</strong>
            <div class="coord-row"><span>D√©part :</span><code id="routeStart">(clic‚Ä¶)</code></div>
            <div class="coord-row"><span>Arriv√©e :</span><code id="routeEnd">(clic‚Ä¶)</code></div>
          </div>
          <div>
            <strong>Barre</strong>
            <div class="coord-row"><span>Point A :</span><code id="blockStart">(clic‚Ä¶)</code></div>
            <div class="coord-row"><span>Point B :</span><code id="blockEnd">(clic‚Ä¶)</code></div>
          </div>
        </div>

        <div class="actions">
          <button id="btnRoute" class="primary" type="button">Trajet</button>
          <button id="btnBlock" class="warn" type="button">Barrer une route</button>
          <button id="btnReset" class="ghost" type="button">Utiliser la carte originale</button>
        </div>

        <div id="routeMeta" class="meta hidden"></div>
      </div>
    </div>

    <div id="resultPanel" class="panel hidden">
      <h3>R√©sultat du trajet</h3>
      <img id="routeImage" alt="Trajet dessin√©" />
      <h4>Itin√©raire</h4>
      <ol id="itineraryList"></ol>
    </div>
  </section>

</main>

<div id="toast" class="toast hidden" role="status" aria-live="polite"></div>

<script src="script.js"></script>
</body>
</html>
